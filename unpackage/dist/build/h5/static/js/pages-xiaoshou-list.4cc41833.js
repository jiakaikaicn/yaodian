(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-xiaoshou-list"],{1422:function(t,a,i){"use strict";i.r(a);var e=i("bfa5"),n=i.n(e);for(var s in e)"default"!==s&&function(t){i.d(a,t,(function(){return e[t]}))}(s);a["default"]=n.a},"77df":function(t,a,i){var e=i("24fb");a=e(!1),a.push([t.i,"[data-v-68aa807f] .uni-group{flex-wrap:nowrap}[data-v-68aa807f] .uni-group .uni-button{margin-left:0;margin-right:10px!important}[data-v-68aa807f] .uni-popup__wrapper{background:#fff!important}.text[data-v-68aa807f]{font-size:28px;margin-top:25px;color:#5479fd}[data-v-68aa807f] .iconfont{font-size:80px!important;color:#128b1a!important;width:80px;height:80px}.grid-dynamic-box[data-v-68aa807f]{margin-bottom:15px}.grid-item-box[data-v-68aa807f]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:15px 0}.grid-item-box-row[data-v-68aa807f]{flex:1;display:flex;flex-direction:row;align-items:center;justify-content:center;padding:15px 0}.grid-dot[data-v-68aa807f]{position:absolute;top:5px;right:15px}@media screen and (min-width:768px) and (max-width:1425px){.swiper[data-v-68aa807f]{height:630px}}@media screen and (min-width:1425px){.swiper[data-v-68aa807f]{height:830px}}.zhifuPopupDiv[data-v-68aa807f]{padding:20px 30px}.zhifuPopupDiv .title[data-v-68aa807f]{padding:10px 0;border-bottom:1px solid #ccc;margin-bottom:10px;font-weight:600;font-size:22px}.zhifuPopupDiv .formDataDiv[data-v-68aa807f]{padding:0 20px}",""]),t.exports=a},add7:function(t,a,i){"use strict";i.d(a,"b",(function(){return n})),i.d(a,"c",(function(){return s})),i.d(a,"a",(function(){return e}));var e={uniPopup:i("4f6b").default,uniTable:i("9e02").default,uniTr:i("158c").default,uniTh:i("1bb9").default,uniTd:i("1cbc").default,uniPagination:i("41c2").default,uniPopupDialog:i("01fe").default,uniGrid:i("d064").default,uniGridItem:i("c531").default,uniForms:i("c032").default,uniFormsItem:i("356a").default,uniEasyinput:i("f17f").default},n=function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("v-uni-view",[i("v-uni-view",{staticClass:"uni-header"},[i("v-uni-view",{staticClass:"uni-group hide-on-phone"},[i("v-uni-view",{staticClass:"uni-title"},[t._v("销售")])],1)],1),i("v-uni-view",[i("v-uni-view",{staticClass:"uni-group"},[i("v-uni-input",{staticClass:"uni-search",attrs:{type:"text",placeholder:"请输入商品名称"},on:{confirm:function(a){arguments[0]=a=t.$handleEvent(a),t.searchFn.apply(void 0,arguments)}},model:{value:t.searchVal,callback:function(a){t.searchVal=a},expression:"searchVal"}}),i("v-uni-button",{staticClass:"uni-button",attrs:{type:"default",size:"mini"},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.searchFn.apply(void 0,arguments)}}},[t._v(t._s(t.$t("common.button.search")))])],1)],1),t._v(t._s(t.baseFormData)+" |||"),i("uni-popup",{ref:"popup"},[i("v-uni-view",{staticClass:"uni-container"},[i("uni-table",{attrs:{loading:t.loading,border:!0,stripe:!0,type:"selection",emptyText:t.$t("common.empty")},on:{"selection-change":function(a){arguments[0]=a=t.$handleEvent(a),t.selectionChange.apply(void 0,arguments)}}},[i("uni-tr",[i("uni-th",{attrs:{width:"40",align:"center"}},[t._v("ID")]),i("uni-th",{attrs:{width:"150",align:"center"}},[t._v("药名")]),i("uni-th",{attrs:{width:"60",align:"center"}},[t._v("规格")]),i("uni-th",{attrs:{width:"100",align:"center"}},[t._v("生产单位")]),i("uni-th",{attrs:{width:"100",align:"center"}},[t._v("有效期")]),i("uni-th",{attrs:{width:"100",align:"center"}},[t._v("生产日期")]),i("uni-th",{attrs:{width:"80",align:"center"}},[t._v("库存")]),i("uni-th",{attrs:{width:"80",align:"center"}},[t._v("单位")]),i("uni-th",{attrs:{width:"120",align:"center"}},[t._v("销售价")])],1),t._l(t.popupTableData,(function(a,e){return i("uni-tr",{key:e},[i("uni-td",{attrs:{align:"center"}},[t._v(t._s(e+1))]),i("uni-td",{attrs:{align:"center"}},[t._v(t._s(a.name))]),i("uni-td",{attrs:{align:"center"}},[t._v(t._s(a.guige))]),i("uni-td",{attrs:{align:"center"}},[t._v(t._s(a.shengchandanwei))]),i("uni-td",{attrs:{align:"center"}},[t._v(t._s(a.youxiaoqi))]),i("uni-td",{attrs:{align:"center"}},[t._v(t._s(a.shengchanriqi))]),i("uni-td",{attrs:{align:"center"}},[t._v(t._s(a.shuliang))]),i("uni-td",{attrs:{align:"center"}},[t._v(t._s(a.danwei))]),i("uni-td",{attrs:{align:"center"}},[t._v(t._s(a.xiaoshou_jia))])],1)}))],2),i("v-uni-view",{staticClass:"uni-pagination-box"},[i("uni-pagination",{attrs:{"show-icon":!0,"page-size":t.pageSize,current:t.pageCurrent,total:t.total},on:{change:function(a){arguments[0]=a=t.$handleEvent(a),t.change.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"uni-group"},[i("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"primary"},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.gotoPage("chuangjianDD")}}},[t._v("创建订单")]),i("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"warn"},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.gotoPage("quxiao")}}},[t._v("取消")])],1)],1)],1),i("v-uni-view",{staticClass:"uni-container"},[i("v-uni-view",{staticClass:"uni-group"},[i("v-uni-button",{staticClass:"uni-button",attrs:{disabled:!(t.tableData.length>0),size:"mini",type:"primary"},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.gotoPage("结算订单")}}},[t._v("结算订单")]),i("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"warn"},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.gotoPage("取消订单")}}},[t._v("取消订单")])],1),t._v(t._s(t.tableData)),i("uni-table",{attrs:{loading:t.loading,border:!0,stripe:!0,type:"selection",emptyText:t.$t("common.empty")},on:{"selection-change":function(a){arguments[0]=a=t.$handleEvent(a),t.selectionChange.apply(void 0,arguments)}}},[i("uni-tr",[i("uni-th",{attrs:{width:"40",align:"center"}},[t._v("ID")]),i("uni-th",{attrs:{width:"150",align:"center"}},[t._v("药名")]),i("uni-th",{attrs:{width:"80",align:"center"}},[t._v("库存")]),i("uni-th",{attrs:{width:"80",align:"center"}},[t._v("购买数量")]),i("uni-th",{attrs:{width:"80",align:"center"}},[t._v("单位")]),i("uni-th",{attrs:{width:"120",align:"center"}},[t._v("销售价")]),i("uni-th",{staticStyle:{color:"#007408"},attrs:{width:"80",align:"center"}},[t._v("实际销售价")]),i("uni-th",{attrs:{width:"60",align:"center"}},[t._v("总价")]),i("uni-th",{attrs:{width:"300",align:"center"}},[t._v("操作")])],1),t._l(t.tableData,(function(a,e){return i("uni-tr",{key:e},[i("uni-td",{attrs:{align:"center"}},[t._v(t._s(e+1))]),i("uni-td",{attrs:{align:"center"}},[t._v(t._s(a.name))]),i("uni-td",{attrs:{align:"center"}},[t._v(t._s(a.shuliang))]),i("uni-td",{attrs:{align:"center"}},[t._v(t._s(a.buy_shuliang))]),i("uni-td",{attrs:{align:"center"}},[t._v(t._s(a.danwei))]),i("uni-td",{attrs:{align:"center"}},[a.new_jiage?i("span",{staticStyle:{"text-decoration":"line-through"}},[t._v(t._s(a.xiaoshou_jia))]):i("span",[t._v(t._s(a.xiaoshou_jia))])]),i("uni-td",{staticStyle:{color:"#007408"},attrs:{align:"center"}},[t._v(t._s(a.new_jiage))]),i("uni-td",{attrs:{align:"center"}},[t._v(t._s(a.xiaoshou_jia*a.buy_shuliang||0))]),i("uni-td",[i("v-uni-view",{staticClass:"uni-group"},[i("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"primary"},on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.gotoPage("edit",a,e)}}},[t._v("修改销售价格")]),i("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"warn"},on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.gotoPage("del",a,e)}}},[t._v(t._s(t.$t("common.button.delete")))]),i("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"warn"},on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.gotoPage("detail",a)}}},[t._v("详情")])],1)],1)],1)}))],2),i("v-uni-view",{staticClass:"uni-pagination-box"},[i("uni-pagination",{attrs:{"show-icon":!0,"page-size":t.pageSize,current:t.pageCurrent,total:t.total},on:{change:function(a){arguments[0]=a=t.$handleEvent(a),t.change.apply(void 0,arguments)}}})],1)],1),i("uni-popup",{ref:"boxNumberBox",attrs:{type:"dialog"}},[i("uni-popup-dialog",{ref:"inputClose",attrs:{beforeClose:!0,mode:"input",title:"数量",value:"1",placeholder:"请输入要核销的盒数"},on:{confirm:function(a){arguments[0]=a=t.$handleEvent(a),t.dialogInputConfirm.apply(void 0,arguments)},close:function(a){arguments[0]=a=t.$handleEvent(a),t.closeFn("boxNumberBox")}}})],1),i("uni-popup",{ref:"ercimimaBox",attrs:{type:"dialog"}},[i("uni-popup-dialog",{ref:"inputClose",attrs:{beforeClose:!0,mode:"pwd",title:"管理员密码",value:"",placeholder:"请输入管理员密码"},on:{confirm:function(a){arguments[0]=a=t.$handleEvent(a),t.confirmFn("ercimimaBox",a)},close:function(a){arguments[0]=a=t.$handleEvent(a),t.closeFn("ercimimaBox")}}})],1),i("uni-popup",{ref:"editJiageBox",attrs:{type:"dialog"}},[i("uni-popup-dialog",{ref:"inputClose",attrs:{beforeClose:!0,mode:"input",title:"请输入要修改的销售价格",value:"",placeholder:"请输入要修改的销售价格"},on:{confirm:function(a){arguments[0]=a=t.$handleEvent(a),t.confirmFn("editJiageBox",a)},close:function(a){arguments[0]=a=t.$handleEvent(a),t.closeFn("editJiageBox")}}})],1),i("v-uni-view",[i("uni-popup",{ref:"jiesuanPopupBox",attrs:{type:"message"}},[i("uni-grid",{attrs:{column:5,highlight:!0},on:{change:function(a){arguments[0]=a=t.$handleEvent(a),t.jiesuanPopupPayChange.apply(void 0,arguments)}}},t._l(t.jiesuanPopupList,(function(a,e){return i("uni-grid-item",{key:e,attrs:{index:e}},[i("v-uni-view",{staticClass:"grid-item-box",staticStyle:{"background-color":"#fff"}},[i("v-uni-view",{staticClass:"iconfont",class:a.iconSrc}),i("v-uni-text",{staticClass:"text"},[t._v(t._s(a.name))])],1)],1)})),1)],1)],1),i("uni-popup",{ref:"zhifuPopup",attrs:{type:"center"}},[i("v-uni-view",{staticClass:"zhifuPopupDiv"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.baseFormData.zhifufangshi))]),i("v-uni-view",{staticClass:"formDataDiv"},[i("uni-forms",{ref:"baseForm",attrs:{modelValue:t.baseFormData,"label-width":80}},[i("uni-forms-item",{attrs:{label:"方式",required:!0}},[i("uni-easyinput",{attrs:{disabled:!0},model:{value:t.baseFormData.zhifufangshi,callback:function(a){t.$set(t.baseFormData,"zhifufangshi",a)},expression:"baseFormData.zhifufangshi"}})],1),i("uni-forms-item",{attrs:{label:"应收",required:!0}},[i("uni-easyinput",{attrs:{disabled:!0},model:{value:t.baseFormData.yingshou,callback:function(a){t.$set(t.baseFormData,"yingshou",a)},expression:"baseFormData.yingshou"}})],1),i("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:"现金支付"==t.baseFormData.title,expression:"baseFormData.title == '现金支付'"}]},[i("uni-forms-item",{attrs:{label:"实收",required:!0}},[i("uni-easyinput",{attrs:{type:"number"},model:{value:t.baseFormData.shishou,callback:function(a){t.$set(t.baseFormData,"shishou",a)},expression:"baseFormData.shishou"}})],1),i("uni-forms-item",{attrs:{label:"找零"}},[i("uni-easyinput",{attrs:{disabled:!0},model:{value:t.baseFormData.zhaoling,callback:function(a){t.$set(t.baseFormData,"zhaoling",a)},expression:"baseFormData.zhaoling"}})],1)],1),i("uni-forms-item",{attrs:{label:"说明"}},[i("uni-easyinput",{model:{value:t.baseFormData.shuoming,callback:function(a){t.$set(t.baseFormData,"shuoming",a)},expression:"baseFormData.shuoming"}})],1)],1),i("v-uni-view",{staticClass:"uni-group"},[i("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"primary"},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.gotoPage("结算")}}},[t._v("结算")]),i("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"warn"},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.gotoPage("重新选择")}}},[t._v("重新选择支付方式")])],1)],1)],1)],1)],1)},s=[]},bfa5:function(t,a,i){"use strict";(function(t){var e=i("4ea4");i("99af"),i("4160"),i("d81d"),i("a434"),i("a9e3"),i("159b"),Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=e(i("2909")),s=e(i("5530")),o=i("26cb"),u={data:function(){return{searchVal:"cs",popupTableData:[],tableData:[],pageSize:10,pageCurrent:1,total:0,loading:!1,selectedIndexs:[],changList:[],clickListIndex:"",jiesuanPopupList:[{name:"现金支付",id:"1",iconSrc:"icon-zhifu"},{name:"医保卡支付",id:"2",iconSrc:"icon-shuaqiazhifu_huaban"},{name:"微信支付",id:"3",iconSrc:"icon-weixinzhifu"},{name:"支付宝支付",id:"4",iconSrc:"icon-zhifubao"},{name:"其它方式",id:"5",iconSrc:"icon-zhifu1"}],baseFormData:{zhifufangshi:"",yingshou:0,shishou:0,zhaoling:0,shuoming:"",buy_shuliang:0,new_jiage:"",addPeople:"",addTime:"",xiaoshouPeople:"",xiaoshouTime:"",dingdanID:""},dingdanList:[]}},computed:(0,s.default)((0,s.default)((0,s.default)((0,s.default)({},(0,o.mapState)("app",["appName"])),(0,o.mapState)("app",["routes"])),(0,o.mapState)("user",["userInfo"])),(0,o.mapState)("error",["logs"])),watch:{"baseFormData.shishou":{handler:function(t,a){this.baseFormData.zhaoling=Number(t)-Number(this.baseFormData.yingshou)}}},onLoad:function(){this.selectedIndexs=[]},methods:{gotoPage:function(t,a,i){switch(this.clickListIndex=i,t){case"chuangjianDD":0==this.selectedIndexs.length?uni.showToast({title:"请最少选择一个药品进行结算",icon:"error"}):this.selectedIndexs.length>1?uni.showToast({title:"你只能一次选择一个药品进行结算",icon:"error"}):this.$refs.boxNumberBox.open();break;case"quxiao":this.close();break;case"del":this.tableData.splice(i,1);break;case"结算订单":this.countFn(),this.$refs.jiesuanPopupBox.open();break;case"取消订单":this.tableData=[];break;case"结算":var e=/^-?[0-9]/;"现金支付"==this.baseFormData.title&&(e.test(this.baseFormData.zhaoling)&&e.test(this.baseFormData.yingshou)?this.baseFormData.zhaoling<0?uni.showToast({title:"请确认找零是否正确",icon:"error"}):this.jiesuanFn():uni.showToast({title:"数据有误，请重新操作一遍",icon:"error"})),this.jiesuanFn();break;case"重新选择":this.$refs.zhifuPopup.close();break;case"edit":this.$refs.ercimimaBox.open();default:break}},close:function(){this.selectedIndexs=[],this.$refs.popup.close()},searchFn:function(){var a=this,i={value:this.searchVal,type:"getListByID"};t.callFunction({name:"a-xiaoshou",data:i,success:function(t){a.$refs.popup.open(),a.popupTableData=t.result.data},fail:function(t){}})},selectedItems:function(){var t=this;return this.selectedIndexs.map((function(a){return t.popupTableData[a]}))},selectionChange:function(t){this.selectedIndexs=t.detail.index,this.changList=this.popupTableData[0]},jiesuanPopupPayChange:function(t){var a,i;a=t.detail.index,i=this.jiesuanPopupList[a].name,this.baseFormData.title=i,this.baseFormData.zhifufangshi=i,this.$refs.zhifuPopup.open()},dialogInputConfirm:function(t){var a=/^[0-9]/;a.test(t)?Number(t)>Number(this.changList.shuliang)?uni.showToast({title:"库存不够，请联系入库员添加",icon:"error"}):(t=t,this.$refs.boxNumberBox.close(),this.$refs.popup.close(),this.$set(this.popupTableData[0],"buy_shuliang",Number(t)),this.tableData=this.tableData.concat(this.popupTableData[this.selectedIndexs]),this.selectedIndexs=[],this.addDingdanList()):uni.showToast({title:"请输入纯数字",icon:"error"})},closeFn:function(t){switch(t){case"ercimimaBox":this.$refs.ercimimaBox.close();break;case"boxNumberBox":this.$refs.boxNumberBox.close();break;case"editJiageBox":this.$refs.editJiageBox.close();break;case"all":this.$refs.ercimimaBox.close(),this.$refs.boxNumberBox.close(),this.$refs.editJiageBox.close(),this.$refs.zhifuPopup.close(),this.$refs.jiesuanPopupBox.close();default:break}},confirmFn:function(t,a){switch(t){case"ercimimaBox":"admin"==a?(this.closeFn("ercimimaBox"),this.$refs.editJiageBox.open()):uni.showToast({title:"管理员密码错误",icon:"error"});break;case"editJiageBox":this.$set(this.tableData[this.clickListIndex],"new_jiage",Number(a)),this.closeFn("editJiageBox");break;default:break}},countFn:function(){var t=0,a=0,i=[];this.tableData.forEach((function(e){var n={};t+=Number(e.new_jiage?e.new_jiage:e.xiaoshou_jia)*Number(e.buy_shuliang),a+=Number(e.buy_shuliang),n.yaopinID=e._id,n.buy_shuliang=e.buy_shuliang,n.new_jiage=e.new_jiage?e.new_jiage:e.xiaoshou_jia,n.zongjia=Number(n.new_jiage)*Number(n.buy_shuliang),i.push(n)})),this.baseFormData.yingshou=t,this.baseFormData.buy_shuliang=a,this.dingdanList=i},jiesuanFn:function(){var a=this;this.baseFormData.xiaoshouPeople=this.userInfo.username;var i=new Date;this.baseFormData.xiaoshouTime=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()+" "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds();var e=(0,s.default)((0,s.default)({type:"addDingdan"},this.baseFormData),{},{zhonglei:this.tableData.length,list:(0,n.default)(this.tableData),isFinish:1});t.callFunction({name:"a-xiaoshou",data:e,success:function(t){var i=t;uni.showModal({title:"提示",content:"结算成功",showCancel:!1,success:function(t){var e=i.result.id;t.confirm?(a.closeFn("all"),a.dingdanXiangqing(e)):t.cancel}})},fail:function(t){}})},addDingdanList:function(){var a=this,i=this;this.countFn(),this.baseFormData.addPeople=this.userInfo.username;var e=new Date;this.baseFormData.addTime=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();var n=(0,s.default)((0,s.default)({},this.baseFormData),{},{zhonglei:this.tableData.length,list:this.tableData[this.tableData.length-1],isFinish:0});""==this.baseFormData.dingdanID?n.type="addDingdan":n.type="upDateDingdan",t.callFunction({name:"a-dingdan",data:n,success:function(t){""==a.baseFormData.dingdanID&&(a.baseFormData.dingdanID=t.result.id),i.closeFn("all"),i.addDingdanXQ()},fail:function(t){}})},addDingdanXQ:function(a){for(var i=this.dingdanList,e=0;e<i.length;e++)i[e].dingdanID=this.baseFormData.dingdanID;var n={type:"addDingdanXQ",list:i};t.callFunction({name:"a-dingdan",data:n,success:function(t){},fail:function(t){}})}}};a.default=u}).call(this,i("a9ff")["default"])},c5fa:function(t,a,i){"use strict";i.r(a);var e=i("add7"),n=i("1422");for(var s in n)"default"!==s&&function(t){i.d(a,t,(function(){return n[t]}))}(s);i("f5d4");var o,u=i("f0c5"),r=Object(u["a"])(n["default"],e["b"],e["c"],!1,null,"68aa807f",null,!1,e["a"],o);a["default"]=r.exports},f144:function(t,a,i){var e=i("77df");"string"===typeof e&&(e=[[t.i,e,""]]),e.locals&&(t.exports=e.locals);var n=i("4f06").default;n("62ec92e2",e,!0,{sourceMap:!1,shadowMode:!1})},f5d4:function(t,a,i){"use strict";var e=i("f144"),n=i.n(e);n.a}}]);